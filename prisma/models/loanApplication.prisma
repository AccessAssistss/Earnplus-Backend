// ####################--------------------Loan Application Model--------------------####################
model LoanApplication {
  id         String     @id @default(uuid())
  customerId String
  productId  String
  approverId String?
  loanCode   String     @unique
  status     LoanStatus @default(PENDING)
  score      Int?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  employee                  Employee                    @relation(fields: [customerId], references: [id])
  masterProduct             MasterProduct               @relation(fields: [productId], references: [id])
  approver                  AssociateSubAdmin?          @relation(fields: [approverId], references: [id])
  fieldValues               LoanFieldValue[]
  LoanApplicationAssignment LoanApplicationAssignment[]
}

// ####################--------------------Loan Field Model--------------------####################
model LoanFieldValue {
  id            String   @id @default(uuid())
  applicationId String
  fieldId       String
  dropdownId    String?
  subFieldId    String?
  value         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  field           Field           @relation(fields: [fieldId], references: [id])
  dropdown        Dropdown?       @relation(fields: [dropdownId], references: [id])
  subField        SubField?       @relation(fields: [subFieldId], references: [id])
  loanApplication LoanApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

// ##########----------Loan Assignment Rule Model----------##########
model LoanAssignmentRule {
  id              String            @id @default(uuid())
  minScore        Int
  maxScore        Int
  chainOrder      Int
  creditManagerId String
  creditManager   AssociateSubAdmin @relation(fields: [creditManagerId], references: [id])

  createdAt DateTime @default(now())
}

model LoanApplicationAssignment {
  id                String   @id @default(uuid())
  loanApplicationId String
  creditManagerId   String
  sequenceOrder     Int // Order of approval
  isApproved        Boolean? // null = pending, true = approved, false = rejected
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  loanApplication LoanApplication   @relation(fields: [loanApplicationId], references: [id], onDelete: Cascade)
  creditManager   AssociateSubAdmin @relation(fields: [creditManagerId], references: [id])
}
